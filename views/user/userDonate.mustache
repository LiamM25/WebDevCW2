{{> header }}
{{> user/userNav}}

<h1>Donation</h1>

<form id="donationForm" action="/user/newDonation" method="POST">
    <!-- Button to Add Another Item -->
    <button type="button" onclick="addAnotherItem()" id="addAnotherItemBtn">Add Another Item</button>

    <!-- First Donation Item Section -->
    <div class="item-section">
        <h1>New item</h1>
        <!-- Item Type Dropdown -->
        <label for="itemType1">Item Type:</label>
        <select class="itemType" name="itemType1" required onchange="toggleHarvestDate(this)">
            <option value="Canned Goods" selected>Canned Goods</option>
            <option value="Fruit/Veg">Fruit/Veg</option>
            <!-- Add other options -->
        </select><br>

        <!-- Harvest Date Field (Initially Hidden) -->
        <div class="harvestDateWrapper" style="display: none;">
            <label for="harvestDate1">Harvest Date:</label>
            <input type="date" name="harvestDate1"><br>
        </div>

        <!-- Item Name Field -->
        <label for="itemName1">Item Name:</label>
        <input type="text" name="itemName1" required><br>

        <!-- Item Quantity Field -->
        <label for="itemQuantity1">Item Quantity:</label>
        <input type="number" name="itemQuantity1" required><br>

        <!-- Weight Field -->
        <label for="weight1">Weight:</label>
        <input type="text" name="weight1"><br>

        <!-- Expiration Date Field -->
        <label for="expirationDate1">Expiration Date:</label>
        <input type="date" name="expirationDate1"><br>

        <!-- Pantry Location Dropdown -->
        <label for="pantryLocation1">Pantry Location:</label>
        <select name="pantryLocation1" required>
            <option value="Pantry1">Pantry1</option>
            <option value="Pantry2">Pantry2</option>
            <!-- Add other options -->
        </select><br>
    </div>

    <!-- Submit Button -->
    <input type="submit" value="Donate">
</form>

<script>

    let itemCount = 1; // Counter to keep track of the number of items
    

    function toggleHarvestDate(selectElement) {
        const selectedItemType = selectElement.value;
        const harvestDateWrapper = selectElement.parentElement.querySelector('.harvestDateWrapper');
        
        // If item type is Fruit/Veg, show the Harvest Date field; otherwise, hide it
        if (selectedItemType === "Fruit/Veg") {
            harvestDateWrapper.style.display = "block";
        } else {
            harvestDateWrapper.style.display = "none";
        }
    }

    function addAnotherItem() {
        itemCount++; // Increment the item counter

        // Clone the first item section
        const firstItemSection = document.querySelector('.item-section');
        const newItemSection = firstItemSection.cloneNode(true);
        
        // Clear input values in the cloned section
        const inputs = newItemSection.querySelectorAll('input');
        inputs.forEach(input => input.value = '');

        // Reset the item type dropdown
        const selectElement = newItemSection.querySelector('.itemType');
        selectElement.selectedIndex = 0;
        toggleHarvestDate(selectElement);

        // Update element names to include item count
        const elements = newItemSection.querySelectorAll('[name]');
        elements.forEach(element => {
            element.name = element.name.replace(/[0-9]+$/, '') + itemCount;
        });

        // Append the cloned section to the form
        const form = document.getElementById('donationForm');
        form.insertBefore(newItemSection, form.lastElementChild);
    }
</script>
